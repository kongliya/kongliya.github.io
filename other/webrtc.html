<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebRTC | 孔孔.</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="孔孔's blog.">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.34ec9d93.js" as="script"><link rel="preload" href="/assets/js/2.a95f0000.js" as="script"><link rel="preload" href="/assets/js/4.63b8f2b8.js" as="script"><link rel="prefetch" href="/assets/js/10.e4f2fbec.js"><link rel="prefetch" href="/assets/js/11.c70c3046.js"><link rel="prefetch" href="/assets/js/12.a2f0dd35.js"><link rel="prefetch" href="/assets/js/13.025223fe.js"><link rel="prefetch" href="/assets/js/14.99ba377c.js"><link rel="prefetch" href="/assets/js/15.48cbe60c.js"><link rel="prefetch" href="/assets/js/16.e31d64ea.js"><link rel="prefetch" href="/assets/js/17.d46d467d.js"><link rel="prefetch" href="/assets/js/18.2f2851d0.js"><link rel="prefetch" href="/assets/js/19.7654b033.js"><link rel="prefetch" href="/assets/js/20.ffe15c90.js"><link rel="prefetch" href="/assets/js/21.e9d52d01.js"><link rel="prefetch" href="/assets/js/3.09ee304c.js"><link rel="prefetch" href="/assets/js/5.0edfab2f.js"><link rel="prefetch" href="/assets/js/6.bc8590aa.js"><link rel="prefetch" href="/assets/js/7.c83e90fb.js"><link rel="prefetch" href="/assets/js/8.98b1d132.js"><link rel="prefetch" href="/assets/js/9.4eb3a41a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">孔孔.</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue/" class="nav-link">
  Vue 3.0
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  Node.js
</a></div><div class="nav-item"><a href="/js/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/other/" class="nav-link router-link-active">
  Other
</a></div><div class="nav-item"><a href="https://github.com/kongliya" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue/" class="nav-link">
  Vue 3.0
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  Node.js
</a></div><div class="nav-item"><a href="/js/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/other/" class="nav-link router-link-active">
  Other
</a></div><div class="nav-item"><a href="https://github.com/kongliya" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/other/" aria-current="page" class="sidebar-link">一些小东西</a></li><li><a href="/other/http.html" class="sidebar-link">网络协议一些东西</a></li><li><a href="/other/vue.html" class="sidebar-link">Vue面试题总结</a></li><li><a href="/other/webrtc.html" aria-current="page" class="active sidebar-link">WebRTC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/other/webrtc.html#是什么" class="sidebar-link">是什么?</a></li><li class="sidebar-sub-header"><a href="/other/webrtc.html#怎么用" class="sidebar-link">怎么用?</a></li><li class="sidebar-sub-header"><a href="/other/webrtc.html#本地媒体" class="sidebar-link">本地媒体</a></li><li class="sidebar-sub-header"><a href="/other/webrtc.html#信令" class="sidebar-link">信令</a></li><li class="sidebar-sub-header"><a href="/other/webrtc.html#sdk封装调试时碰到的问题记录" class="sidebar-link">SDK封装调试时碰到的问题记录</a></li></ul></li><li><a href="/other/linux.html" class="sidebar-link">linux简单命令记录</a></li><li><a href="/other/angular.html" class="sidebar-link">angular4配置环境变量</a></li><li><a href="/other/flutter.html" class="sidebar-link">flutter</a></li><li><a href="/other/webpack.html" class="sidebar-link">webpack配置多环境变量</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webrtc"><a href="#webrtc" class="header-anchor">#</a> WebRTC</h1> <p>研究webrtc这一块也有一段时间了，<br>
做一个总结吧。</p> <h2 id="是什么"><a href="#是什么" class="header-anchor">#</a> 是什么?</h2> <p>Web的实时通信技术, 支持网页浏览器进行实时音视频对话的API, 而不需要安装插件。<br>
Webrtc提供视频会议的核心技术, 包括音视频采集、编解码、网络传输、显示等功能, 而且也支持跨平台。</p> <p>webrtc中文文档地址: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebRTC_API" target="_blank" rel="noopener noreferrer">webrtc中文文档-MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
webrtc官网地址: <a href="https://webrtc.org" target="_blank" rel="noopener noreferrer">webrtc官网(需要翻墙)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
Developer ==&gt; Getting started 之中会有很多Demos and samples可以帮助你更快的上手;</p> <p>书籍的话比较经典的一本: 《WebRTC权威指南》</p> <p>需要搞懂的也是我一直比较混的几个概念:</p> <ol><li><p>信令：有时候我们会将浏览器和服务器之前的连接称之为信令，但并非电话系统中所用的信令。信令在webrtc之中并未标准化, 因为它只是被视为应用程序的一部分。信令可以通过http或者webSocket传送到向浏览器提供HTML页面的同一Web服务器，也可传送到只负责处理信令的一个完全不同的Web服务器。</p></li> <li><p>媒体协商：通信会话中的双方(例如两个浏览器)进行通信并就可接受的媒体会话达成一致的过程。<br>
&quot;提议/应答&quot;就是一种媒体协商方式。</p></li></ol> <h2 id="怎么用"><a href="#怎么用" class="header-anchor">#</a> 怎么用?</h2> <h3 id="建立webrtc会话"><a href="#建立webrtc会话" class="header-anchor">#</a> 建立WebRTC会话</h3> <ol><li>获取本地媒体;  ==&gt;  getUserMedia()</li> <li>在浏览器和对等端(其他浏览器或者终端)之间建立连接;  ==&gt;  RTCPeerConnection()  包含ICE&quot;打洞&quot;通过各种网络地址转换设备和防火墙时使用的信息;</li> <li>将媒体和数据通道关联至该连接;  ==&gt;  RTCSessionDescription()</li> <li>交换会话描述。  ==&gt; SDP会话描述协议;</li></ol> <p><img src="/assets/img/webrtc.d7696189.png" alt="建立WebRTC会话"></p> <h2 id="本地媒体"><a href="#本地媒体" class="header-anchor">#</a> 本地媒体</h2> <h3 id="webrtc中的媒体"><a href="#webrtc中的媒体" class="header-anchor">#</a> WebRTC中的媒体</h3> <p>轨道：MediaStreamTrack 基本媒体单元
流：MediaStream 是 轨道：MediaStreamTrack对象的集合
媒体选择和控制
可约束的属性：枚举属性和范围属性;</p> <h2 id="信令"><a href="#信令" class="header-anchor">#</a> 信令</h2> <h3 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h3> <ol><li>协商媒体功能和设置;</li> <li>标识和验证会话参与者的身份;</li> <li>控制媒体会话、指示进度、更改会话和终止会话;</li> <li>当会话双方同时尝试建立或更改会话时，实施双占用分解。</li></ol> <p>目前是没有信令标准的，可自由选择。</p> <h3 id="媒体协商"><a href="#媒体协商" class="header-anchor">#</a> 媒体协商</h3> <p>信令最重要的功能在于，参与对等连接的两个浏览器之间交换会话描述协议(SDP)对象中包含的信息。<br>
SDP之中包含供浏览器中RTP媒体栈配置媒体会话所需的全部信息，包括媒体类型(音频、视频、数据)、所用的编解码器(Opus、G.711等)、用于编解码器的各个参数或设置，以及有关带宽的信息。<br>
此外，信令通道还用于交换候选地址，以便进行ICE打洞。
候选地址表示浏览器可从中接收潜在媒体数据包的IP地址和UDP端口。<br>
在信令通道中收发的候选地址也可以不包含在SDP之中。另外，还必须在信令通道中交换用于SRTP的密钥材料。<br>
只有通过信令交换候选地址后才能开始ICE打洞，因此如果没有此信令功能，就无法建立对等连接。</p> <p>本人认为知道以上概念很重要。</p> <p>信令传输方式： HTTP、WebSocket、数据通道;</p> <ol><li>HTTP</li></ol> <p>浏览器发起新的HTTP请求，以便向服务器发送信令信息并从中接收信令信息。<br>
信令信息可以可使用GET和POST方法或以应答形式传输。</p> <ol start="2"><li>WebSocket</li></ol> <p>WebSocket传输允许浏览器开通一个与服务器的双向连接。此连接最初采用HTTP请求形式，但随后会升级为WebSocket。<br>
只要服务器支持CORS，WebSocket服务器的IP地址就可以不同于Web服务器。<br>
任何信令都可以通过WebSocket进行传输。</p> <p>为了访问WebSocket服务器，必须拥有公共IP地址。因为两个浏览器之间无法直接开通WebSocket，所以需要WebSocket服务器在两个使用WebSocket的浏览器之间提供中继。</p> <ol start="3"><li>数据通道传输</li></ol> <p>当两个浏览器建立数据通道后，它就会提供直接的低延迟连接，很适合传输信令。<br>
由于最初建立数据通道时需要单独的信令机制，因此信令通道无法单独用于所有WebRTC信令。但是一旦建立信令通道，可以用它来处理所有的信令。</p> <p>好处： 有助于缩短用户感知的建立连接所需的时间。</p> <h2 id="sdk封装调试时碰到的问题记录"><a href="#sdk封装调试时碰到的问题记录" class="header-anchor">#</a> SDK封装调试时碰到的问题记录</h2> <h3 id="sdk之中添加进来adapter"><a href="#sdk之中添加进来adapter" class="header-anchor">#</a> SDK之中添加进来adapter</h3> <p>adapter是sdk的兼容插件，作用是为了兼容各个浏览器以更好的支持webrtc；</p> <p>因为webrtc还没有出标准 所以各个浏览器之间就像是方言一般的存在 为了互通理解 所以需要添加进去adapter。</p> <p>webrtc-adapter使用步骤：</p> <p><a href="https://www.javascriptcn.com/read-34969.html" target="_blank" rel="noopener noreferrer">adapter介绍安装<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>webrtc-adapter解释：</p> <p><a href="https://webrtc.org.cn/adapterjs-1/" target="_blank" rel="noopener noreferrer">adapter介绍1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://webrtc.org.cn/adapterjs-2/" target="_blank" rel="noopener noreferrer">adapter介绍1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="webrtc-internal中追溯某一个流的途径"><a href="#webrtc-internal中追溯某一个流的途径" class="header-anchor">#</a> webrtc-internal中追溯某一个流的途径</h3> <p>source ==&gt; stream ==&gt; track ==&gt; sender/recevier</p> <h3 id="调试工具"><a href="#调试工具" class="header-anchor">#</a> 调试工具</h3> <p>chrome://webrtc-internals/  插件</p> <p><img src="/assets/img/webrtc1.d44e5fbb.png" alt="界面展示"> <img src="/assets/img/webrtc2.64418516.png" alt="一些参数说明"></p> <h3 id="srtp"><a href="#srtp" class="header-anchor">#</a> SRTP</h3> <p>SRTP(SecureReal-time Transport Protocol) 安全实时传输协议，SRTP是在实时传输协议(Real-time Transport Protocol)基础上所定义的一个协议，旨在为单播和多播应用程序中的实时传输协议的数据提供加密、消息认证、完整性保证和重放保护安全实时传输协议。</p> <p>协议格式：</p> <p><img src="/assets/img/srtp1.cf6c1d2c.png" alt="协议格式"> <img src="/assets/img/srtp2.eee59f53.png" alt="格式参数说明"></p> <h3 id="stun-turn"><a href="#stun-turn" class="header-anchor">#</a> STUN/TURN</h3> <p>1，STUN服务器是用来取外网地址的；<br>
2，TURN服务器是在P2P失败时进行转发的；</p> <p>每个TURN服务器都支持STUN，ICE处理负责的NAT设置，同时NAT打洞要求不止是一个公网IP和端口。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/other/vue.html" class="prev">
        Vue面试题总结
      </a></span> <span class="next"><a href="/other/linux.html">
        linux简单命令记录
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.34ec9d93.js" defer></script><script src="/assets/js/2.a95f0000.js" defer></script><script src="/assets/js/4.63b8f2b8.js" defer></script>
  </body>
</html>
